{"remainingRequest":"/root/pinda-authority-ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/root/pinda-authority-ui/src/views/pinda/user/org/Index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/root/pinda-authority-ui/src/views/pinda/user/org/Index.vue","mtime":1586894142000},{"path":"/root/pinda-authority-ui/node_modules/cache-loader/dist/cjs.js","mtime":499205700000},{"path":"/root/pinda-authority-ui/node_modules/babel-loader/lib/index.js","mtime":499205700000},{"path":"/root/pinda-authority-ui/node_modules/cache-loader/dist/cjs.js","mtime":499205700000},{"path":"/root/pinda-authority-ui/node_modules/vue-loader/lib/index.js","mtime":499205700000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport orgApi from '@/api/Org.js'\r\nimport options from '@/api/OrgType.json'\r\nexport default {\r\n  name: 'OrgManager',\r\n  data() {\r\n    return {\r\n      name: '',\r\n      orgTypeOptions: '',\r\n      orgTree: [],\r\n      parentName: '无上级',\r\n      provinceList: [],\r\n      cityList: [],\r\n      countryList: [],\r\n      managerList: [],\r\n      requestParameters: {},\r\n      org: this.initOrg(),\r\n      rules: {\r\n        name: [\r\n          {\r\n            required: true,\r\n            message: this.$t('rules.require'),\r\n            trigger: 'blur'\r\n          },\r\n          {\r\n            min: 1,\r\n            max: 255,\r\n            message: this.$t('rules.range3to10'),\r\n            trigger: 'blur'\r\n          }\r\n        ]\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.orgTypeOptions = options\r\n    this.initOrgTree()\r\n    this.showcity()\r\n    this.getManagerList()\r\n  },\r\n  methods: {\r\n    initOrg() {\r\n      return {\r\n        id: '',\r\n        abbreviation: '',\r\n        name: '',\r\n        orgType: '',\r\n        address: '',\r\n        contractNumber: '',\r\n        provinceId: '',\r\n        cityId: '',\r\n        countyId: '',\r\n        managerId: '',\r\n        parentId: 0,\r\n        status: true,\r\n        describe: '',\r\n        sortValue: 0\r\n      }\r\n    },\r\n    async showcity() {\r\n      this.requestParameters.parentId = 0\r\n      orgApi.areaList(this.requestParameters).then(response => {\r\n        this.provinceList = response.data\r\n      })\r\n    },\r\n    async showcity1() {\r\n      this.requestParameters.parentId = 0\r\n      orgApi.areaList(this.requestParameters).then(response => {\r\n        this.provinceList = response.data\r\n      })\r\n      this.getProvince1()\r\n    },\r\n    async getProvince1() {\r\n      // eslint-disable-next-line eqeqeq\r\n      if (this.org.provinceId != 0) {\r\n        this.requestParameters.parentId = this.org.provinceId\r\n        const { data: res } = await orgApi.areaList(this.requestParameters)\r\n        this.cityList = res\r\n        this.getCity1()\r\n      }\r\n    },\r\n    async getProvince() {\r\n      // eslint-disable-next-line eqeqeq\r\n      if (this.org.provinceId != 0) {\r\n        this.requestParameters.parentId = this.org.provinceId\r\n        const { data: res } = await orgApi.areaList(this.requestParameters)\r\n        this.cityList = res\r\n        this.org.cityId = ''\r\n        this.getCity()\r\n      }\r\n    },\r\n    async getCity() {\r\n      // eslint-disable-next-line eqeqeq\r\n      if (this.org.cityId != 0) {\r\n        this.requestParameters.parentId = this.org.cityId\r\n        const { data: res } = await orgApi.areaList(this.requestParameters)\r\n        this.countryList = res\r\n        this.org.countyId = ''\r\n      }\r\n    },\r\n    async getCity1() {\r\n      // eslint-disable-next-line eqeqeq\r\n      if (this.org.cityId != 0) {\r\n        this.requestParameters.parentId = this.org.cityId\r\n        const { data: res } = await orgApi.areaList(this.requestParameters)\r\n        this.countryList = res\r\n      }\r\n    },\r\n    getArea() {\r\n      console.log(this.countryCode)\r\n    },\r\n    // 获取负责人列表\r\n    async getManagerList() {\r\n      orgApi.managerList().then(response => {\r\n        this.managerList = response.data\r\n      })\r\n    },\r\n    initOrgTree() {\r\n      orgApi.allTree({}).then(response => {\r\n        const res = response.data\r\n        this.orgTree = res.data\r\n      })\r\n    },\r\n    exportExcel() {\r\n      this.$message({\r\n        message: '待完善',\r\n        type: 'warning'\r\n      })\r\n      // this.$download('system/org/excel', {\r\n      //   name: this.name\r\n      // }, `org_${new Date().getTime()}.xlsx`)\r\n    },\r\n    handleNumChange(val) {\r\n      this.org.sortValue = val\r\n    },\r\n    filterNode(value, data) {\r\n      if (!value) return true\r\n      return data.label.indexOf(value) !== -1\r\n    },\r\n    nodeClick(data) {\r\n      this.org = { ...data }\r\n      orgApi.getOrg({ ids: this.org.parentId }).then(response => {\r\n        const res = response.data\r\n        this.parentName = res.data[0].name\r\n      })\r\n      this.showcity1()\r\n      this.$refs.form.clearValidate()\r\n    },\r\n    add() {\r\n      this.resetForm()\r\n      const checked = this.$refs.orgTree.getCheckedKeys()\r\n      console.log(checked)\r\n      if (checked.length > 1) {\r\n        this.$message({\r\n          message: this.$t('tips.onlyChooseOne'),\r\n          type: 'warning'\r\n        })\r\n      } else if (checked.length > 0) {\r\n        orgApi.getOrg({ ids: checked[0] }).then(response => {\r\n          const res = response.data\r\n          this.parentName = res.data[0].name\r\n        })\r\n        this.org.parentId = checked[0]\r\n      } else {\r\n        this.org.parentId = 0\r\n        this.parentName = '无上级'\r\n      }\r\n    },\r\n    deleteOrg() {\r\n      const checked = this.$refs.orgTree.getCheckedKeys()\r\n      if (checked.length === 0) {\r\n        this.$message({\r\n          message: this.$t('tips.noNodeSelected'),\r\n          type: 'warning'\r\n        })\r\n      } else {\r\n        this.$confirm(\r\n          this.$t('tips.confirmDeleteNode'),\r\n          this.$t('common.tips'),\r\n          {\r\n            confirmButtonText: this.$t('common.confirm'),\r\n            cancelButtonText: this.$t('common.cancel'),\r\n            type: 'warning'\r\n          }\r\n        )\r\n          .then(() => {\r\n            orgApi.delete({ ids: checked }).then(response => {\r\n              const res = response.data\r\n              if (res.isSuccess) {\r\n                this.$message({\r\n                  message: this.$t('tips.deleteSuccess'),\r\n                  type: 'success'\r\n                })\r\n              }\r\n              this.reset()\r\n            })\r\n          })\r\n          .catch(() => {\r\n            this.$refs.orgTree.setCheckedKeys([])\r\n          })\r\n      }\r\n    },\r\n    search() {\r\n      this.$refs.orgTree.filter(this.name)\r\n    },\r\n    reset() {\r\n      this.initOrgTree()\r\n      this.name = ''\r\n      this.resetForm()\r\n    },\r\n    submit() {\r\n      this.$refs.form.validate(valid => {\r\n        if (valid) {\r\n          if (this.org.id) {\r\n            this.update()\r\n          } else {\r\n            this.save()\r\n          }\r\n        } else {\r\n          return false\r\n        }\r\n      })\r\n    },\r\n    save() {\r\n      orgApi.save({ ...this.org }).then(response => {\r\n        const res = response.data\r\n        if (res.isSuccess) {\r\n          this.$message({\r\n            message: this.$t('tips.createSuccess'),\r\n            type: 'success'\r\n          })\r\n        }\r\n\r\n        this.reset()\r\n      })\r\n    },\r\n    update() {\r\n      console.log({ ...this.org })\r\n      orgApi.update({ ...this.org }).then(response => {\r\n        const res = response.data\r\n        if (res.isSuccess) {\r\n          this.$message({\r\n            message: this.$t('tips.updateSuccess'),\r\n            type: 'success'\r\n          })\r\n        }\r\n        this.reset()\r\n      })\r\n    },\r\n    resetForm() {\r\n      this.$refs.form.clearValidate()\r\n      this.$refs.form.resetFields()\r\n      this.org = this.initOrg()\r\n    }\r\n  }\r\n}\r\n",null]}